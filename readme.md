# New Relic Insights Log4Net Appender

Appender for Log4Net which sends data to New Relic Insights.

# Prerequisites
* .NET 4.5 or later 
* A New Relic Account with Insights Pro subscription (trial can be started [here](https://newrelic.com/signup))

# Nuget Installation

To install the Log4Net appender, use the following steps:

```
PM> Install-Package NewRelicInsights.Log4Net
```

# Configuring

### Example Appender Configuration
```xml
<configuration>
  <configSections>
    <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net" />
  </configSections>
  <log4net>
    <appender name="NewRelicAppender" type="NewRelicInsights.Log4Net.NewRelicInsightsAppender, NewRelicInsights.Log4Net">
      <layout type="NewRelicInsights.Log4Net.JsonLayout"></layout>
      <ApiEndPoint value="https://insights-collector.newrelic.com/v1/accounts/1234567/events" />
      <InsertKey value="insert_key_here"/>
    </appender>
    <root>
      <priority value="ALL" />
      <level value="ALL" />
      <appender-ref ref="NewRelicAppender" />
    </root>
  </log4net>
  <startup>
    <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.5.2" />
  </startup>
</configuration>
```

Configuration Links:
* [Log4Net](https://logging.apache.org/log4net/release/config-examples.html)
* [New Relic Insights API Key](https://docs.newrelic.com/docs/insights/insights-data-sources/custom-data/insert-custom-events-insights-api)

### Example Code
```csharp
public static class Program
{
    public static void Main()
    {
        XmlConfigurator.Configure();
        var Log = LogManager.GetLogger(typeof(Program));

        LogicalThreadContext.Properties["eventType"] = "NewRelicInsightsExampleLogs";

        Log.Info("Hello World!");
    
        Console.ReadKey();
    }
}
```

Warning: In the above example code, `LogicalThreadContext.Properties["eventType"] = "NewRelicInsightsExampleLogs";` needs to be added as New Relic Insights expects eventType property in the input json content.

[More information on Insights limits and restricted characters](https://docs.newrelic.com/docs/insights/insights-data-sources/custom-data/insert-custom-events-insights-api#limits)


### Request JSON generated by appender
```json
{
	"workingSet" : 1234567,
	"osVersion" : "Microsoft Windows NT 6.1.7601 Service Pack 1",
	"is64bitOS" : true,
	"is64bitProcess" : false,
	"processSessionId" : "6f490e49-5ec9-4377-92b1-735ffad45ec9",
	"level" : "INFO",
	"messageObject" : "Hello World!",
	"renderedMessage" : "Hello World!",
	"timestampUtc" : "2017-01-01T01:01:01.1234567Z",
	"logger" : "NewRelicInsights.Log4Net.Example.Program",
	"thread" : "1",
	"exceptionObject" : null,
	"exceptionObjectString" : null,
	"userName" : "TestUser",
	"domain" : "NewRelicInsights.Log4Net.Example.exe",
	"identity" : "",
	"location" : "NewRelicInsights.Log4Net.Example.Program.Main(C:\\Projects\\NewRelicInsights.Log4Net\\src\\NewRelicInsights.Log4Net\\NewRelicInsights.Log4Net.Example\\Program.cs:41)",
	"pid" : 12345,
	"machineName" : "MyMachineName",
	"eventType" : "NewRelicInsightsExampleLogs",
	"log4net:Identity" : "",
	"log4net:UserName" : "TestUser",
	"log4net:HostName" : "MyMachineName"
}
```

### Success Response from New Relic Insights
```json
{
    "success": true
}
```

# License

[MIT](LICENSE)